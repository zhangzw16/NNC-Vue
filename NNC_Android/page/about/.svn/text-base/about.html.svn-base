<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.css" rel="stylesheet" />
		<link href="../../css/appCss/about.css" rel="stylesheet" />
	</head>
	
	<body>
		<header class="mui-bar mui-bar-nav">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="color: #000;"></a>
		    <h1 class="mui-title">关于</h1>
		</header>
		<div class="mui-backdrop" >
			<div class="share-box displayNone">
				<a href="javascript:sharebox_close();" class="mui-icon mui-icon-close wechat-box-close"></a>
				<div class="wechat-img" id="share_img_upload">
					<p>尼基APP下载二维码</p>
					<img src="../../image/qc_card/nnc_upload.png" />
				</div>
				<p class="share-title">分享到站外:</p>
				<ul class="other-share-box">
					<li>
						<img src="../../image/weChatF.png"/ id="wxp_upload">
						<p>微信朋友圈</p>
					</li>
					<li>
						<img src="../../image/weixin.png"/ id="wxhy_upload">
						<p>微信好友</p>
					</li>
					<li>
						<img src="../../image/qq.png"/ id="qqhy_upload">
						<p>QQ好友</p>
					</li>
					<li>
						<img src="../../image/sinaweibo.png" id="wb_upload"/>
						<p>微博</p>
					</li>
				</ul>
			</div>
			<div class="share-box-app displayNone">
				<a href="javascript:sharebox_close();" class="mui-icon mui-icon-close wechat-box-close"></a>
				<div class="wechat-img" id="share_img_public">
					<p>尼基营养微信公众号</p>
					<img src="../../image/qc_card/nnc_public.png" />
				</div>
				<p class="share-title">分享到站外:</p>
				<ul class="other-share-box">
					<li>
						<img src="../../image/weChatF.png"/ id="wxp_public">
						<p>微信朋友圈</p>
					</li>
					<li>
						<img src="../../image/weixin.png"/ id="wxhy_public">
						<p>微信好友</p>
					</li>
					<li>
						<img src="../../image/qq.png"/ id="qqhy_public">
						<p>QQ好友</p>
					</li>
					<li>
						<img src="../../image/sinaweibo.png" id="wb_public"/>
						<p>微博</p>
					</li>
				</ul>
			</div>
		</div>
	
		<div class="mui-content">
			<div class="about-head">
				<img src="../../image/login_logo.png"  style="width: 5.8em;margin-top: 1.1em;"/>
				<p>尼基营养 —— 您的健康保护伞！</p>
			</div>
				<ul class="mui-table-view mui-table-view-chevron about-list" >
					<li id="phone" class="mui-table-view-cell mui-media">
						服务热线
						<span>010-81766618</span>
					</li>
					<li class="mui-table-view-cell" onclick="shareApp()">
						微信公众号
						<span class="wx-logo">尼基营养</span>
					</li>
				
					<li class="mui-table-view-cell ">
						<a href="javascript:sharebox_show();" class="mui-navigate-right about-share">
							分享尼基
						</a>
					</li>
				</ul>
		</div>
		<footer>
			<p>尼基科技&nbsp; &nbsp;版权所有</p>
			<p class="colorBule" onclick="toNiji()">www.nijikeji.com</p>
			<p>Copyright © 2015-2017 Nijikeji</p>
			<p style="margin-top: -7px;">All Rights Reserved</p>
		</footer>
		<script src="../../js/jquery.min.js"></script>
		<script src="../../js/html2canvas.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/mui.min.js"></script>
		<script type="text/javascript" src="../../js/h.js" ></script>
		<script type="text/javascript">
			mui.init();
		
			mui.plusReady(function(){
				Internet_connection();
				h('#wxp_upload').tap(function(){
					share_nnc_upload(2);
			    });
			    h('#wxhy_upload').tap(function(){
					share_nnc_upload(1);
			    });
			    h('#qqhy_upload').tap(function(){
					share_nnc_upload(3);
			    });
			    h('#wb_upload').tap(function(){
					share_nnc_upload(4);
			    });
			    
			    h('#wxp_public').tap(function(){
					share_nnc_public(2);
			    });
			    h('#wxhy_public').tap(function(){
					share_nnc_public(1);
			    });
			    h('#qqhy_public').tap(function(){
					share_nnc_public(3);
			    });
			    h('#wb_public').tap(function(){
					share_nnc_public(4);
			    });
			    document.getElementById("phone").addEventListener('tap',function(){
		            var btnArray=['拨打','取消'];
		            var phone="010-81766618";
		            mui.confirm('是否拨打'+phone+'?','提示',btnArray,function(e){
		                if(e.index == 0){
		                    plus.device.dial(phone,false);
		                }
		            });
		        });
			});
			function sharebox_show(){
				var mask = $(".mui-backdrop,.share-box");
				mask.show();
			}
			function shareApp(){
				var mask = $(".mui-backdrop,.share-box-app");
				mask.show();
			}
			function sharebox_close(){
				var mask = $(".mui-backdrop,.share-box,.share-box-app");
				mask.hide();
			}
			function toNiji(){
				mui.openWindow({
					url : '../../page/about/toNiji.html',
					id  : 'toNiji.html'
				})
			}
			function NNCwebsite(){
				mui.openWindow({
					url : 'website.html',
					id  : 'website.html'
				});
			}
			var shareWx = null;
			var shareQQ = null;
			var shareWb = null; 
			function share_nnc_upload(type){//分享方法
				plus.share.getServices(function(services){//成功方法
					for(var k in services){
						if(services[k].id == 'weixin'){
							shareWx = services[k];
						}else if(services[k].id =='qq'){
							shareQQ = services[k];
						}else if(services[k].id == 'sinaweibo'){
							shareWb = services[k];
						}
					}
					if(shareWx == null){
						mui.toast('您没有安装微信');
						return;
					}
					if(shareQQ == null){
						mui.toast('您没有安装QQ');
						return;
					}
					if(shareWb == null){
						mui.toast('您没有安装微博');
						return;
					}
					var w = $("#share_img_upload").width();
					var h = $("#share_img_upload").height();
					
					//要将 canvas 的宽高设置成容器宽高的 2 倍
					var canvas = document.createElement("canvas");
					canvas.width = w*3;
					canvas.height = h*3.4;
					canvas.style.width = w + "px";
					canvas.style.height = h + "px";
					var context = canvas.getContext("2d");
					//然后将画布缩放，将图像放大两倍画到画布上 
					context.translate(-170,-205);
					context.scale(3,3);
					html2canvas(document.getElementById("share_img_upload"),
			        	{
			                allowTaint: true,
			                taintTest: false,
			                canvas: canvas,
			                onrendered: function(canvas) {
			                    canvas.id = "mycanvas";
			                    var dataUrl = canvas.toDataURL();
			                    var bitmap=new plus.nativeObj.Bitmap();
								bitmap.loadBase64Data(
									dataUrl,
									function(e){
										console.log('创建成功');
										bitmap.save( "_doc/share_qr_card_upload.png"
										,{
											overwrite:true,
											format : 'png',
											quality : 100
										}
										,function(i){
											console.log('保存图片成功：'+JSON.stringify(i));
											if(i.size != 0){
												var msg = {
													content: '尼基营养', 
													pictures: ['_doc/share_qr_card_upload.png']
												};
												if(type == 1){//分享到好友
													msg.extra = {scene:"WXSceneSession"}
													if (shareWx.authenticated) {//已经认证
														shareWx.send(msg, function() { //分享成功方法
															mui.toast('分享成功');
														}, function(e) { //分享失败方法
															mui.toast('您取消了分享');
														});
													} else {//未认证
														shareWx.authorize(function(){
															shareWx.send(msg, function() { //分享成功方法
																mui.toast('分享成功');
															}, function(e) { //分享失败方法
																mui.toast('您取消了分享');
															});
														}, function(e){
															mui.toast("授权失败");
														})
													}
												}else if(type == 2){//分享到朋友圈
													msg.extra = {scene:"WXSceneTimeline"}
													if (shareWx.authenticated) {//已经认证
														shareWx.send(msg, function() { //分享成功方法
															mui.toast('分享成功');
														}, function(e) { //分享失败方法
															mui.toast('您取消了分享');
														});
													} else {//未认证
														shareWx.authorize(function(){
															shareWx.send(msg, function() { //分享成功方法
																mui.toast('分享成功');
															}, function(e) { //分享失败方法
																mui.toast('您取消了分享');
															});
														}, function(e){
															mui.toast("授权失败");
														})
													}
												}else if(type == 3){//分享到QQ好友
													if (shareQQ.authenticated) {//已经认证
														shareQQ.send(msg, function() { //分享成功方法
															mui.toast('分享成功');
														}, function(e) { //分享失败方法
															mui.toast('您取消了分享');
														});
													} else {//未认证
														shareQQ.authorize(function(){
															shareQQ.send(msg, function() { //分享成功方法
																mui.toast('分享成功');
															}, function(e) { //分享失败方法
																mui.toast('您取消了分享');
															});
														}, function(e){
															mui.toast("授权失败");
														})
													}
												} else {//分享到微博
													if (shareWb.authenticated) {//已经认证
														shareWb.send(msg, function() { //分享成功方法
															mui.toast('分享成功');
														}, function(e) { //分享失败方法
															mui.toast('您取消了分享');
														});
													} else {//未认证
														shareWb.authorize(function(){
															shareWb.send(msg, function() { //分享成功方法
																mui.toast('分享成功');
															}, function(e) { //分享失败方法
																mui.toast('您取消了分享');
															});
														}, function(e){
															mui.toast("授权失败");
														})
													}
												}
												bitmap.clear();
											}
										}
										,function(e){
											console.log('保存图片失败：'+JSON.stringify(e));
											bitmap.clear();
										});
									},function(e){
										console.log('创建失败：'+JSON.stringify(e));
								});
			                }
			            });
				}, function(){//失败方法
					mui.toast('获取分享服务失败');
				});
			}
			function share_nnc_public(type){//分享方法
				plus.share.getServices(function(services){//成功方法
					for(var k in services){
						if(services[k].id == 'weixin'){
							shareWx = services[k];
						}else if(services[k].id =='qq'){
							shareQQ = services[k];
						}else if(services[k].id == 'sinaweibo'){
							shareWb = services[k];
						}
					}
					if(shareWx == null){
						mui.toast('您没有安装微信');
						return;
					}
					if(shareQQ == null){
						mui.toast('您没有安装QQ');
						return;
					}
					if(shareWb == null){
						mui.toast('您没有安装微博');
						return;
					}
					var w = $("#share_img_public").width();
					var h = $("#share_img_public").height();
					
					//要将 canvas 的宽高设置成容器宽高的 2 倍
					var canvas = document.createElement("canvas");
					canvas.width = w*3;
					canvas.height = h*3.4;
					canvas.style.width = w + "px";
					canvas.style.height = h + "px";
					var context = canvas.getContext("2d");
					//然后将画布缩放，将图像放大两倍画到画布上 
					context.translate(-170,-205);
					context.scale(3,3);
					html2canvas(document.getElementById("share_img_public"),
			        	{
			                allowTaint: true,
			                taintTest: false,
			                canvas: canvas,
			                onrendered: function(canvas) {
			                    canvas.id = "mycanvas";
			                    var dataUrl = canvas.toDataURL();
			                    var bitmap=new plus.nativeObj.Bitmap();
								bitmap.loadBase64Data(
									dataUrl,
									function(e){
										console.log('创建成功');
										bitmap.save( "_doc/share_qr_card_public.png"
										,{
											overwrite:true,
											format : 'png',
											quality : 100
										}
										,function(i){
											console.log('保存图片成功：'+JSON.stringify(i));
											if(i.size != 0){
												var msg = {
													content: '尼基营养', 
													pictures: ['_doc/share_qr_card_public.png']
												};
												if(type == 1){//分享到好友
													msg.extra = {scene:"WXSceneSession"}
													shareWx.send(msg, function(){//分享成功方法
														mui.toast('分享成功');
													}, function(){//分享失败方法
														mui.toast('您取消了分享');
													});
												}else if(type == 2){//分享到朋友圈
													msg.extra = {scene:"WXSceneTimeline"}
													shareWx.send(msg, function(){//分享成功方法
														mui.toast('分享成功');
													}, function(){//分享失败方法
														mui.toast('您取消了分享');
													});
												}else if(type == 3){//分享到QQ好友
													shareQQ.send(msg, function(){//分享成功方法
														mui.toast('分享成功');
													}, function(){//分享失败方法
														mui.toast('您取消了分享');
													});
												}else{//分享到微博
													shareWb.send(msg, function(i){//分享成功方法
														console.log(JSON.stringify(i));
														mui.toast('分享成功');
													}, function(e){//分享失败方法
														console.log(JSON.stringify(e));
														mui.toast('您取消了分享');
													});
												}
												bitmap.clear();
											}
										}
										,function(e){
											console.log('保存图片失败：'+JSON.stringify(e));
											bitmap.clear();
										});
									},function(e){
										console.log('创建失败：'+JSON.stringify(e));
								});
			                }
			            });
				}, function(){//失败方法
					mui.toast('获取分享服务失败');
				});
			}
		</script>
	</body>

</html>